<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Playback Error Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            color: #388e3c;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1565c0;
        }
        #console {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üéµ MelodyHub Audio Playback Error Fix Test</h1>
    
    <div class="test-section">
        <h2>Problem Demonstration</h2>
        <p>This test demonstrates the audio playback errors that occurred before the fix:</p>
        
        <h3>Before Fix (Original Code Issues):</h3>
        <div class="error">
            ‚ùå <strong>Uncaught Promise Rejection:</strong> audio.play() returns a Promise that was not caught<br>
            ‚ùå <strong>No Error Handling:</strong> Users see no feedback when audio fails to load<br>
            ‚ùå <strong>Missing Validation:</strong> No checks for audio element existence<br>
            ‚ùå <strong>Poor Error Messages:</strong> Browser-specific error messages confuse users
        </div>
        
        <h3>After Fix:</h3>
        <div class="success">
            ‚úÖ <strong>Promise Error Handling:</strong> audio.play() Promise is properly caught<br>
            ‚úÖ <strong>User-Friendly Errors:</strong> Clear Japanese error messages for users<br>
            ‚úÖ <strong>Input Validation:</strong> Validates audio element and parameters<br>
            ‚úÖ <strong>Graceful Degradation:</strong> Fallback for API failures<br>
            ‚úÖ <strong>Audio State Management:</strong> Properly resets audio before loading new tracks
        </div>
    </div>

    <div class="test-section">
        <h2>Interactive Test</h2>
        <p>Test the fixed audio playback functionality:</p>
        
        <button onclick="testValidAudio()">Test Valid Audio File</button>
        <button onclick="testInvalidAudio()">Test Invalid Audio File</button>
        <button onclick="testNullAudio()">Test Null Audio Element</button>
        <button onclick="clearConsole()">Clear Console</button>
        
        <h3>Console Output:</h3>
        <div id="console"></div>
        
        <audio id="testAudio" controls style="width: 100%; margin: 10px 0;"></audio>
    </div>

    <script>
        const consoleDiv = document.getElementById('console');
        const audio = document.getElementById('testAudio');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            consoleDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function clearConsole() {
            consoleDiv.innerHTML = '';
        }
        
        // Improved playSong function (simplified version of the fix)
        function playSongFixed(audioElement, songPath) {
            if (!audioElement) {
                log('‚ùå „Ç™„Éº„Éá„Ç£„Ç™„Éó„É¨„Ç§„É§„Éº„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }
            
            if (!songPath) {
                log('‚ùå Èü≥Ê•Ω„Éï„Ç°„Ç§„É´„ÅÆ„Éë„Çπ„ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }
            
            log(`üéµ Loading audio from: ${songPath}`);
            
            const handlePlayError = (error) => {
                console.error('Audio playback failed:', error);
                let errorMessage = 'Èü≥Ê•Ω„ÅÆÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
                
                if (error.name === 'NotSupportedError') {
                    errorMessage = 'Èü≥Ê•Ω„Éï„Ç°„Ç§„É´„ÅÆÂΩ¢Âºè„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì';
                } else if (error.name === 'NotAllowedError') {
                    errorMessage = '„Éñ„É©„Ç¶„Ç∂„Å´„Çà„Å£„Å¶ÂÜçÁîü„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü';
                } else if (error.message) {
                    errorMessage += `: ${error.message}`;
                }
                
                log(`‚ùå ${errorMessage}`, 'error');
            };
            
            try {
                audioElement.src = songPath;
                audioElement.load();
                
                const playPromise = audioElement.play();
                
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            log('‚úÖ Audio playback started successfully', 'success');
                        })
                        .catch(handlePlayError);
                }
            } catch (error) {
                handlePlayError(error);
            }
        }
        
        function testValidAudio() {
            log('Testing with valid audio file...');
            playSongFixed(audio, 'monsterhunter/Another Treat.mp3');
        }
        
        function testInvalidAudio() {
            log('Testing with invalid audio file...');
            playSongFixed(audio, 'nonexistent/fake-song.mp3');
        }
        
        function testNullAudio() {
            log('Testing with null audio element...');
            playSongFixed(null, 'monsterhunter/Another Treat.mp3');
        }
        
        log('üéµ MelodyHub Audio Fix Test Ready - Click buttons to test different scenarios');
    </script>
</body>
</html>